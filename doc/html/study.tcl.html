<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- Generated by TclDoc 0.3 -->
<html>
<head><title>study.tcl</title></head>
<body bgcolor="#ffffff">
<font size="-2">
<a href="xsmurf_tcl_lib_intro.html">Overview</a> | Index by:  <a href="index_main.html#study.tcl">file name</a> |
<a href="index_main.html#byprocname">procedure name</a> |
<a href="index_main.html#bycall">procedure call</a> |
<a href="index_annot_full.html">annotation</a>
</font>
<hr>
<strong>study.tcl</strong>
(<a href="study.tcl-annot.html">annotations</a> | <a href="study.tcl.txt">original source</a>)
<p>
<pre>
<font color="#208020"># study.tcl --</font>
<font color="#208020">#</font>
<font color="#208020">#       This file implements the Tcl code to compute all kind of study and to</font>
<font color="#208020"># store its results and its &#34;state&#34;.</font>
<font color="#208020">#</font>
<font color="#208020">#   Copyright 1998 Centre de Recherche Paul Pascal, Bordeaux, France.</font>
<font color="#208020">#   Written by Nicolas Decoster.</font>
<font color="#208020">#</font>
<font color="#208020">#  RCS : $Id: study.tcl,v 1.31 1999/03/29 13:33:08 decoster Exp $</font>
<font color="#208020">#</font>

package provide study 0.0

namespace eval study {
    variable study

    namespace export init end param compute
}


<font color="#208020"># st --</font>
<font color="#208020">#</font>

<strong><a name="st_24">proc <a href="study.tcl-annot.html#st">st</a></a></strong><a name="st"></a> args {
    if {[llength $args] != 0} {
	set cmd [concat namespace inscope study $args]
	set code [catch {eval $cmd} result]
	if {$code != 0} {
	    return -code error $result
	} else {
	    return $result
	}
    }
}


<font color="#208020"># study::init --</font>
<font color="#208020"># usage : study::init [-filename str] [-force] [-desc array]</font>
<font color="#208020">#</font>
<font color="#208020">#   Init the parameters of a study. The paramters of the study must be stored</font>
<font color="#208020"># in a file whose default name is paramters.tcl.</font>
<font color="#208020">#   The file must contain the base directory for the study. By default this</font>
<font color="#208020"># procedure must be execute in the base directory. This is done to avoid</font>
<font color="#208020"># pathname error. This can be escape by the -force option.</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   none.</font>
<font color="#208020">#</font>
<font color="#208020"># Options :</font>
<font color="#208020">#   -filename : gah !</font>
<font color="#208020">#      string - file name.</font>
<font color="#208020">#   -force : escape the directory check.</font>
<font color="#208020">#   -desc : check the validity of parameters.</font>
<font color="#208020">#      array - descriptor of the parameters. Each element describe a parameter.</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   The study id.</font>

<strong><a name="study::init_59">proc <a href="study.tcl-annot.html#study::init">study::init</a></a></strong><a name="study::init"></a> {args} {
    <font color="#208020"># Default value of the proc variables.</font>

    set fileName parameters.tcl
    set curDir [pwd]
    set isForce 0
    set isDesc 0

    <font color="#208020"># Arguments analysis</font>

    while {[string match -* $args]} {
	switch -exact -- [lindex $args 0] {
	    -filename {
		set fileName [lindex $args 1]
		set args [lreplace $args 0 1]
	    }
	    -force {
		set isForce 1
		set args [lreplace $args 0 0]
	    }
	    -desc {
		set isDesc 1
		upvar [lindex $args 1] desc
		set args [lreplace $args 0 1]
	    }
	    --  {
		set args [lreplace $args 0 0]
		break
	    }
	    default {
		return -code error &#34;unknown option \&#34;[lindex $args 0]\&#34;&#34;
	    }
	}
    }

    <font color="#208020"># Get an id and create param array.</font>

    variable study
    if ![info exists study(sid)] {
	set study(sid) 0
    }
    set sid [namespace current]::[incr study(sid)]
    variable $sid
    upvar 0 $sid param

    <font color="#208020"># Read parameters.</font>

    set f [open $fileName r]
    while {[gets $f l] != -1} {

	if {[llength $l] == 0} {
	    <font color="#208020"># Avoid empty lines.</font>

	    continue
	}

	if {[regexp {^# *} [lindex $l 0]] == 1} {
	    <font color="#208020"># Avoid lines that begins with '#'.</font>

	    continue
	}

	if {[string compare [lindex $l 0] set] == 0} {
	    <font color="#208020"># For backward compatibility, we remove leading &#34;set&#34; string.</font>

	    set l [lreplace $l 0 0]
	}

	set parameter [lindex $l 0]
	set value [lindex $l 1]

	if {$isDesc &amp;&amp; [info exists desc($parameter)]} {
	    <font color="#208020"># If requested, we check the type validity of the parameters</font>
	    <font color="#208020"># describe by desc array.</font>

	    set type [lindex $desc($parameter) 1]
	    set code [catch {CheckType $value $type} result]
	    if {$code == 1} {
		<font color="#208020"># Wrong type.</font>

		catch {unset param}
		return -code error &#34;parsing parameter \&#34;$parameter\&#34; : $result&#34;
	    } else {
		set param($parameter) $value
	    }
	} else {
	    set param($parameter) $value
	}
    }
    close $f

    if {$isDesc} {
	<font color="#208020"># Now we set all the parameters that are describe in desc and that were</font>
	<font color="#208020"># not defined in fileName.</font>

	set searchId [array startsearch desc]
	while {[array anymore desc $searchId] == 1} {
	    set parameter [array nextelement desc $searchId]
	    if {[info exists param($parameter)] == 0} {
		set default [lindex $desc($parameter) 0] 
		if {[string compare $default &#34;requested&#34;] == 0} {
		    <font color="#208020"># The parameter _must_ have been defined in fileName.</font>

		    catch {unset param}
		    return -code error &#34;parameter \&#34;$parameter\&#34; is not optional&#34;
		} else {
		    set param($parameter) $default
		}
	    }
	}
	array donesearch desc $searchId
    }

    if {!$isForce} {
	<font color="#208020"># Check if the base directory of the study is the same than the current</font>
	<font color="#208020"># directory.</font>

	if {[string compare $curDir $param(baseDir)] != 0} {
	    catch {unset param}
	    return -code error &#34;you must init your study from its base directory. Unless you use -force option&#34;
	}
    }

    return $sid
}


<font color="#208020"># study::CheckType - PRIVATE</font>
<font color="#208020"># usage : CheckType list list</font>
<font color="#208020">#</font>
<font color="#208020">#   Check the validity of a value according to its decriptor.</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   list - list of values.</font>
<font color="#208020">#   list - list of types (-boolean, -int, ...). Help on each type will come</font>
<font color="#208020">#     soon (I hope).</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   No value. In case of bad type, an error is raised.</font>

<strong><a name="study::CheckType_199">proc <a href="study.tcl-annot.html#study::CheckType">study::CheckType</a></a></strong><a name="study::CheckType"></a> {valueLst typeLst} {
    foreach value $valueLst type $typeLst {
	switch -exact -- [lindex $type 0] {
	    -boolean {
		if ![regexp {^(0|1)$} $value] {
		    error &#34;bad type&#34;
		}
	    }
	    -int {
		if ![regexp {^(-+)?[0-9]+$} $value] { 
		    error &#34;bad type&#34;
		}
	    }
	    -posint {
		if ![regexp {^[+]?[0-9]+$} $value] { 
		    error &#34;bad type&#34;
		}
	    }
	    -float {
		if {[scan $value &#34;%f%s&#34; dummy dummy] != 1} {
		    error &#34;bad type&#34;
		}
	    }
	    -posfloat {
		if {[scan $value &#34;%f%s&#34; dummy dummy] != 1} {
		    error &#34;bad type&#34;
		}
		if {$dummy &lt; 0} {
		    error &#34;bad type&#34;
		}
	    }
	    -intfloat {
		if {[scan $value &#34;%f%s&#34; dummy dummy] != 1} {
		    error &#34;bad type&#34;
		}
		if {($dummy &lt; [lindex $type 1]) \
			|| ($dummy &gt; [lindex $type 2])} {
		    error &#34;bad type&#34;
		}
	    }
	    -dir {
		if {[file isdirectory $value] != 1} {
		    error &#34;bad type&#34;
		}
	    }
	    -string {
		return
	    }
	    -list {
		set type [lreplace $type 0 1]
		foreach newValue $value {
		    set code [catch \
			    {CheckType $newValue $type} \
			    result]
		    if {$code == 1} {
			error $result
		    }
		}
	    }
	    default {
		eval $type
	    }
	}
    }
    return
}


<font color="#208020"># study::end --</font>
<font color="#208020"># usage : study::end studyId</font>
<font color="#208020">#</font>
<font color="#208020">#   End a study and free all memory that can be freed.</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   studyId - the study id.</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   None.</font>

<strong><a name="study::end_278">proc <a href="study.tcl-annot.html#study::end">study::end</a></a></strong><a name="study::end"></a> {sid} {
    if {[CheckSid $sid] == 0} {
	return -code error &#34;wrong study id&#34;
    }
    variable $sid
    upvar 0 $sid param
    unset param
    return
}


<font color="#208020"># study::CheckSid - PRIVATE</font>
<font color="#208020"># usage : CheckSid studyId</font>
<font color="#208020">#</font>
<font color="#208020">#   Check if a study id is valid.</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   studyId - the study id.</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   1 if valid, 0 otherwise.</font>

<strong><a name="study::CheckSid_300">proc <a href="study.tcl-annot.html#study::CheckSid">study::CheckSid</a></a></strong><a name="study::CheckSid"></a> {sid} {
    <font color="#208020"># For now this proc only check the existence of sid as an array. In the</font>
    <font color="#208020"># future we can imagine other checks.</font>

    if [array exists $sid] {
	return 1
    } else {
	return 0
    }
}


<font color="#208020"># study::param --</font>
<font color="#208020"># usage : study::param studyId [-channel channelId] [-help array]</font>
<font color="#208020">#</font>
<font color="#208020">#   Puts the name and the value of all parameters on stdout.</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   studyId - the study id.</font>
<font color="#208020">#</font>
<font color="#208020"># Options :</font>
<font color="#208020">#   -channel : use another channel.</font>
<font color="#208020">#      channelId - the channel id.</font>
<font color="#208020">#   -help : add an help at the end of each line.</font>
<font color="#208020">#      array - descriptor of the parameters. Each element describe a parameter.</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   None.</font>

<strong><a name="study::param_329">proc <a href="study.tcl-annot.html#study::param">study::param</a></a></strong><a name="study::param"></a> {sid args} {
    if {[CheckSid $sid] == 0} {
	return -code error &#34;wrong study id&#34;
    }
    variable $sid
    upvar 0 $sid param

    <font color="#208020"># Default values</font>

    set channelId stdout
    set isHelp 0

    <font color="#208020"># Arguments analysis</font>

    while {[string match -* $args]} {
	switch -glob -- [lindex $args 0] {
	    -channel {
		set channelId [lindex $args 1]
		set args [lreplace $args 0 1]
	    }
	    -help {
		set isHelp 1
		upvar [lindex $args 1] desc
		set args [lreplace $args 0 1]
	    }
	    --  {
		set args [lreplace $args 0 0]
		break
	    }
	    default {
		return -code error &#34;unknown option \&#34;[lindex $args 0]\&#34;&#34;
	    }
	}
    }

    <font color="#208020"># Search the maximum length of all parameter and value strings to format</font>
    <font color="#208020"># output.</font>

    set pMaxLength 0
    set vMaxLength 0
    set searchId [array startsearch param]
    while {[array anymore param $searchId] == 1} {
	set parameter [array nextelement param $searchId]
	set length [string length $parameter]
	if {$length &gt; $pMaxLength} {
	    set pMaxLength $length
	}
	set value $param($parameter)
	set length [string length $value]
	if {$length &gt; $vMaxLength} {
	    set vMaxLength $length
	}
    }
    <font color="#208020"># To be changed...</font>
    if {$vMaxLength &gt; 30} {
	set vMaxLength 30
    }

    <font color="#208020"># Output...</font>

    array donesearch param $searchId
    set searchId [array startsearch param]
    while {[array anymore param $searchId] == 1} {
	set parameter [array nextelement param $searchId]
	set value $param($parameter)
	if {$isHelp &amp;&amp; [info exists desc($parameter)]} {
	    <font color="#208020"># With help message (if it exists).</font>

	    set help [lindex $desc($parameter) 2]
	    puts $channelId [format \
		    &#34;%-${pMaxLength}s %-${vMaxLength}s %s&#34; \
		    $parameter $value $help]
	} else {
	    puts $channelId [format \
		    &#34;%-${pMaxLength}s %-${vMaxLength}s&#34; \
		    $parameter $value]
	}
    }
    array donesearch param $searchId

    return
}


<font color="#208020"># study::param2var --</font>
<font color="#208020"># usage : study::param2var studyId</font>
<font color="#208020">#</font>
<font color="#208020">#   Create a variable in the current scope for each parameter.</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   studyId - the study id.</font>
<font color="#208020">#</font>
<font color="#208020"># Options :</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   None.</font>

<strong><a name="study::param2var_426">proc <a href="study.tcl-annot.html#study::param2var">study::param2var</a></a></strong><a name="study::param2var"></a> {sid args} {
    if {[CheckSid $sid] == 0} {
	return -code error &#34;wrong study id&#34;
    }
    variable $sid
    upvar 0 $sid param

    <font color="#208020"># Default values</font>

    set channelId stdout
    set isHelp 0

    <font color="#208020"># Arguments analysis</font>

    while {[string match -* $args]} {
	switch -glob -- [lindex $args 0] {
	    default {
		return -code error &#34;unknown option \&#34;[lindex $args 0]\&#34;&#34;
	    }
	}
    }

    <font color="#208020"># Set the variables.</font>

    set searchId [array startsearch param]
    while {[array anymore param $searchId] == 1} {
	set parameter [array nextelement param $searchId]
	set value $param($parameter)
	uplevel 1 [list set $parameter $value]
    }
    array donesearch param $searchId

    return
}


<font color="#208020"># study::compute --</font>
<font color="#208020"># usage : study::compute studyId script</font>
<font color="#208020">#</font>
<font color="#208020">#   Compute a script for a study</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters :</font>
<font color="#208020">#   studyId - the study id.</font>
<font color="#208020">#   script  - the script.</font>
<font color="#208020">#</font>
<font color="#208020"># Return value :</font>
<font color="#208020">#   Result of the script.</font>

<strong><a name="study::compute_474">proc <a href="study.tcl-annot.html#study::compute">study::compute</a></a></strong><a name="study::compute"></a> {sid script} {
    if {[CheckSid $sid] == 0} {
	return -code error &#34;wrong study id&#34;
    }
    variable $sid
    upvar 0 $sid param

    <font color="#208020"># First, we modify the script to create variables associated to each</font>
    <font color="#208020"># parameter.</font>

    set newScript $script
    set searchId [array startsearch param]
    while {[array anymore param $searchId] == 1} {
	set parameter [array nextelement param $searchId]
	set value $param($parameter)
	set newScript &#34;set $parameter [list $value]\n$newScript&#34;
    }
    array donesearch param $searchId

    eval $newScript
    
    return
}



<font color="#208020">#####################################################################</font>

<font color="#208020"># Here begins the old version of study.tcl. This is kept for compatibility.</font>


<font color="#208020">#</font>
<font color="#208020">#   This procedure execute a complete study of a given statistical set of a kind</font>
<font color="#208020"># of image. The only parameter of this proc is the directory where the results</font>
<font color="#208020"># will be saved. In this directory it must be a file (parameters.tcl) that</font>
<font color="#208020"># contains all the parameters of the study. Example :</font>
<font color="#208020">#</font>
<font color="#208020">#    set first_image 0       (number of the first image to study)</font>
<font color="#208020">#    set last_image 7        (number of the last image to study)</font>
<font color="#208020">#    set size 512            (size of the images)</font>
<font color="#208020">#    set amin 2              (value of the minimum scale)</font>
<font color="#208020">#    set noct 4              (number of octaves)</font>
<font color="#208020">#    set nvox 8              (number of voices)</font>
<font color="#208020">#    set nbox_mod 1024       (size of the modulus's histograms)</font>
<font color="#208020">#    set nbox_arg 512        (size of the gradient's histograms)</font>
<font color="#208020">#    set calendos_size 512   (size of the french-cheese histograms which smell)</font>
<font color="#208020">#    set border_percent 0.75 (value which gives the size of the border to cut)</font>
<font color="#208020">#                            (this size is this value times the greatest scale)</font>
<font color="#208020">#                            (the best value to avoid border effects is)</font>
<font color="#208020">#                            (probably 0.75)</font>
<font color="#208020">#    set similitude 0.8      (similitude for the research of vertical line)</font>
<font color="#208020">#    set angle 0</font>
<font color="#208020">#    set isgaussian 0        (Gaussian study)</font>
<font color="#208020">#    set ismexican 0         (Mexican hat study)</font>
<font color="#208020">#    set issave 0            (save histo and part fcts beetween each image)</font>
<font color="#208020">#                            (study so that crashes don't pollute results)</font>
<font color="#208020">#    set ishisto 0           (compute the continuous histograms)</font>
<font color="#208020">#    set ismaxhisto 0        (compute the maxima histograms)</font>
<font color="#208020">#    set ishistoinit 0       (init the histograms)</font>
<font color="#208020">#    set iscontpart 0        (compute the continuous partition fcts)</font>
<font color="#208020">#    set q_lst {-2 -1 0 1 2} (list of the values of q, for max partition fcts)</font>
<font color="#208020">#    set pos_q_lst {0 1 2}   (list of the positives values of q, for images)</font>
<font color="#208020">#                            (partition fcts)</font>
<font color="#208020">#    set theta_lst {0 0.1 m0 0.74 0.3 m1}</font>
<font color="#208020">#                            (list of theta d_theta name triplet. To compute)</font>
<font color="#208020">#                            (partition fcts conditioned by gradient)</font>
<font color="#208020">#                            (orientation. Name is the base name of the)</font>
<font color="#208020">#                            (partition fcts files)</font>
<font color="#208020">#</font>
<font color="#208020">#   The directories 00, 01, etc must exist and must contain an image (named</font>
<font color="#208020"># 'image').</font>
<font color="#208020">#   The procedure computes the maxima, the complete histograms, the maxima</font>
<font color="#208020"># histograms and the partition functions of the maxima (depend on the values of</font>
<font color="#208020"># 'is' parameters).</font>
<font color="#208020">#   The values of q for the partition functions of the maxima must be stored in</font>
<font color="#208020"># a file named 'q_values'. For the partition functions of all the wavelet values</font>
<font color="#208020"># the file is named 'pos_q_values'</font>
<font color="#208020">#</font>

<strong><a name="study_553">proc <a href="study.tcl-annot.html#study">study</a></a></strong><a name="study"></a> {<a name="dir(1)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    cd $dir
    
    <font color="#208020"># Get parameters</font>
    source ${<a name="dir(2)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/parameters.tcl

    <font color="#208020"># Existence of the parameters</font>
    puts &#34;&#34;
    puts &#34;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&#34;
    puts &#34;&#34;
    puts &#34;Parameters verification :&#34;
    puts &#34;  first image :       $first_image&#34;
    puts &#34;  last image :        $last_image&#34;
    puts &#34;  Size of the image : $size&#34;
    puts &#34;  First scale :       $amin&#34;
    puts &#34;  Number of octave :  $noct&#34;
    puts &#34;  Number of voice :   $nvox&#34;
    puts &#34;  Border percent :    $border_percent&#34;
    puts &#34;     (0 -&gt; gaussian, 1 -&gt; gaussiann and mexican hat)&#34;
    puts &#34;  Size of the modulus's histograms :  $nbox_mod&#34;
    puts &#34;  Size of the gradient's histograms : $nbox_arg&#34;
    puts &#34;  Size of the french-cheese histograms which smell : $calendos_size&#34;
    puts &#34;  Initialisation of the histograms ? $ishistoinit&#34;
    puts &#34;  Saving the ext_image ? $issave&#34;
    puts &#34;  Histograms ? $ishisto&#34;
    puts &#34;  similitude ? $similitude&#34;
    puts &#34;  Gaussian study ? $isgaussian&#34;
    puts &#34;  Mexican study ? $ismexican&#34;
    puts &#34;  Functions of partitions conditioned by the angle ? $angle&#34;
    puts &#34;&#34;
    puts &#34;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&#34;
    puts &#34;&#34;
    puts &#34;&#34;

    <font color="#208020"># Validity of the parameters</font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int(2*$scale_max*$border_percent)]

    if {$scale_max &gt;= $size} {
	puts &#34; .. are you crazy? the scale max is greater than the size of the image&#34;
	return
    }
    if {$border_size &gt;= $size} {
	puts &#34; .. are you crazy? the borders effects are greater than the size of the image&#34;
	return
    }

    <font color="#208020"># Initialisation of the histograms</font>
    if {$ishistoinit == 1} {
	catch {exec mkdir histograms}
	if {$isgaussian == 1} {
	    <a name="nputs(1)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;\nHistograms initialisation (Gaussian).\n&#34;
	    <a name="set_hist_limits(1)"><a href="./study.tcl.html#set_hist_limits_654">set_hist_limits</a></a> $dir
	}
	if {$ismexican == 1} {
	    <a name="nputs(2)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;\nHistograms initialisation (Mexican).\n&#34;
	    <a name="set_hist_mexican_limits(1)"><a href="./study.tcl.html#set_hist_mexican_limits_778">set_hist_mexican_limits</a></a> $dir
	}
    }

    <font color="#208020"># Now we begin the computation of the WT</font>
    <a name="nputs(3)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;\nComputation.\n&#34;
    catch {exec mkdir partition}
    catch {exec mkdir sauve}

    <font color="#208020"># For all images</font>
    for {set i $first_image} {$i &lt;= $last_image} {incr i} {
	set new_i [format &#34;%.2d&#34; $i]
	puts &#34;------- Image number $new_i -------\n&#34;
	if {$isgaussian == 1} {
	    <a name="dputs(1)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;Compute the WTMM.&#34;
	    <a name="compute_wtmm(1)"><a href="./study.tcl.html#compute_wtmm_969">compute_wtmm</a></a> ${<a name="dir(3)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/$new_i
	    <a name="compute_wtmm_max_stat(1)"><a href="./study.tcl.html#compute_wtmm_max_stat_1251">compute_wtmm_max_stat</a></a> ${<a name="dir(4)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/$new_i
	}
	if {$ismexican == 1} {
	    puts &#34;&#34;
	    <a name="dputs(2)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;Compute the mexican hat.&#34;
	    <a name="compute_mexican(1)"><a href="./study.tcl.html#compute_mexican_1054">compute_mexican</a></a> ${<a name="dir(5)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/$new_i
	    <a name="compute_mexican_max_stat(1)"><a href="./study.tcl.html#compute_mexican_max_stat_1360">compute_mexican_max_stat</a></a> ${<a name="dir(6)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/$new_i
	}

	if {$issave == 1} {
	    puts &#34;&#34;
	    <a name="nputs(4)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  Save&#34;
	    cd $dir
	    exec cp -r ${<a name="dir(7)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/partition ${<a name="dir(8)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/sauve
	    exec cp -r ${<a name="dir(9)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/histograms ${<a name="dir(10)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/sauve
	}
	<a name="dputs(3)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  Ok, Baby! Computation of this image completed !\n&#34;
    }
    puts &#34;&#34;
    puts &#34;This is the end.&#34;
}


<font color="#208020">#   Procedure to set the histograms limits of the wavelet coeficients made with</font>
<font color="#208020"># the Gaussian.</font>
<font color="#208020">#</font>
<strong><a name="set_hist_limits_654">proc <a href="study.tcl-annot.html#set_hist_limits">set_hist_limits</a></a></strong><a name="set_hist_limits"></a> {<a name="dir(11)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    set pi 3.1416
    set m_pi -3.1416

    source ${<a name="dir(12)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name min_max_hist

    set hist_min 1e30
    set hist_max 0
    
    <font color="#208020"># Get the size of the border </font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int($scale_max*$border_percent)]

    for {set i $first_image} {$i &lt;= $last_image} {incr i} {
	set new_i [format &#34;%.2d&#34; $i]
	<a name="dputs(4)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;Image number $new_i.&#34;
	iload ${<a name="dir(13)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/${new_i}/image image

	igfft   image __ft
	delete  image
	isave   __ft
	delete  __ft

	<a name="nputs(5)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  setting the limits of the modulus histograms :&#34;
	<a name="dputs(5)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    with the upper scale...&#34;
	set scale [expr $amin*pow(2,$noct-1+(($nvox-1)/double($nvox)))]
	set scale [expr $scale*(6/0.86)]
	<a name="__conv_dx(1)"><a href="./wt.tcl.html#__conv_dx_85">__conv_dx</a></a> $scale
	<a name="__conv_dy(1)"><a href="./wt.tcl.html#__conv_dy_91">__conv_dy</a></a> $scale
	gmod dx dy mod
	cutedge mod mod $border_size
	set result [im_extrema mod]
	set min_upper [lindex $result 0]
	set max_upper [lindex $result 1]

	<a name="dputs(6)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    and the lower scale...&#34;
	set scale [expr $amin*(6/0.86)]
	<a name="__conv_dx(2)"><a href="./wt.tcl.html#__conv_dx_85">__conv_dx</a></a> $scale
	<a name="__conv_dy(2)"><a href="./wt.tcl.html#__conv_dy_91">__conv_dy</a></a> $scale
	gmod dx dy mod
	cutedge mod mod $border_size
	set result [im_extrema mod]
	set min_lower [lindex $result 0]
	set max_lower [lindex $result 1]

	delete dx dy mod IMAGE

	if {$min_lower &lt; $hist_min} {
	    set hist_min $min_lower
	}
	if {$min_upper &lt; $hist_min} {
	    set hist_min $min_upper
	}
	if {$max_upper &gt; $hist_max} {
	    set hist_max $max_upper
	}
	if {$max_lower &gt; $hist_max} {
	    set hist_max $max_lower
	}
	puts &#34;&#34;
    }
    <a name="dputs(7)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;The range of modulus histogram for all images is :&#34;
    <a name="nputs(6)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  from $hist_min to $hist_max.&#34;
    puts &#34;&#34;

    set hist_file_id [open $hist_file_name w]
    puts $hist_file_id &#34;$hist_min&#34;
    puts $hist_file_id &#34;$hist_max&#34;
    close $hist_file_id

    <font color="#208020"># Initialisation of the global histograms at each scale.</font>
    sinus histo_tmp 100
    shisto histo_tmp h_mod_tmp $nbox_mod -x $hist_min $hist_max
    shisto histo_tmp h_arg_tmp $nbox_arg -x $m_pi $pi
    sscamult h_mod_tmp 0.0 h_mod_tmp
    sscamult h_arg_tmp 0.0 h_arg_tmp

    inull calendos_temp $calendos_size
    cd ${<a name="dir(14)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/histograms
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    set new_num [format &#34;%.3d&#34; $num]

            <font color="#208020">#  Gradient histograms from all points (mod, arg, gradient vector)</font>
            ssave h_mod_tmp h_mod$new_num -sw
            ssave h_arg_tmp h_arg$new_num -sw
            isave calendos_temp calendos_image$new_num

            <font color="#208020">#  Gradient histograms from all points on lines (mod, arg,</font>
            <font color="#208020"># gradient vector)</font>
            ssave h_mod_tmp h_max_mod$new_num -sw
            ssave h_arg_tmp h_max_arg$new_num -sw
            isave calendos_temp calendos_max$new_num

            <font color="#208020">#  Gradient histograms from all max on lines (mod, arg, gradient</font>
            <font color="#208020"># vector)</font>
            ssave h_mod_tmp h_max_line_mod$new_num -sw
            ssave h_arg_tmp h_max_line_arg$new_num -sw
            isave calendos_temp calendos_max_line$new_num

	}
    }
    delete histo_tmp
    delete h_mod_tmp
    delete h_arg_tmp
    delete calendos_temp
    cd ${<a name="dir(15)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}
    exec rm __ft
}

<font color="#208020">#</font>
<font color="#208020"># procedure to set the histograms limits of the wavelet coeficients</font>
<font color="#208020"># made with the Mexican Hat.</font>
<font color="#208020">#</font>

<strong><a name="set_hist_mexican_limits_778">proc <a href="study.tcl-annot.html#set_hist_mexican_limits">set_hist_mexican_limits</a></a></strong><a name="set_hist_mexican_limits"></a> {<a name="dir(16)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    source ${<a name="dir(17)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name min_max_hist_mexican

    set hist_min 1e30
    set hist_max -1e30
    
    <font color="#208020"># Get the size of the border </font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int($scale_max*$border_percent)]

    for {set i $first_image} {$i &lt;= $last_image} {incr i} {
	set new_i [format &#34;%.2d&#34; $i]
	<a name="dputs(8)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;Image number $new_i.&#34;
	iload ${<a name="dir(18)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/${new_i}/image im

	itofft  im IMAGE
	isave   im im.0
	delete im
	fft     IMAGE
	isave   IMAGE im.1

	<a name="nputs(7)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  setting the limits of the histograms :&#34;
	<a name="dputs(9)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    with the upper scale...&#34;
	set scale [expr $amin*pow(2,$noct-1+(($nvox-1)/double($nvox)))]
	set scale [expr $scale*(6/0.86)]
	<a name="conv_w(1)"><a href="./mmto.tcl.html#conv_w_11">conv_w</a></a> mexican $scale
	cutedge mexican mexican $border_size
	set result [im_extrema mexican]

	set min_upper [lindex $result 0]
	set max_upper [lindex $result 1]

	<a name="dputs(10)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    and the lower scale...&#34;
	set scale [expr $amin*(6/0.86)]
	<a name="conv_w(2)"><a href="./mmto.tcl.html#conv_w_11">conv_w</a></a> mexican $scale
	cutedge mexican mexican $border_size
	set result [im_extrema mexican]
	set min_lower [lindex $result 0]
	set max_lower [lindex $result 1]

	delete mexican IMAGE

	if {$min_lower &lt; $hist_min} {
	    set hist_min $min_lower
	}
	if {$min_upper &lt; $hist_min} {
	    set hist_min $min_upper
	}
	if {$max_upper &gt; $hist_max} {
	    set hist_max $max_upper
	}
	if {$max_lower &gt; $hist_max} {
	    set hist_max $max_lower
	}
	puts &#34;&#34;
    }
    <a name="dputs(11)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;The range of mexican histogram for all images is :&#34;
    <a name="nputs(8)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  from $hist_min to $hist_max.&#34;
    puts &#34;&#34;

    set hist_file_id [open $hist_file_name w]
    puts $hist_file_id &#34;$hist_min&#34;
    puts $hist_file_id &#34;$hist_max&#34;
    close $hist_file_id

    <font color="#208020"># Initialisation of the global histograms at each scale.</font>
    sinus histo_tmp 100
    shisto histo_tmp h_mexican_tmp $nbox_mod -x $hist_min $hist_max

    sscamult h_mexican_tmp 0.0 h_mexican_tmp

    cd ${<a name="dir(19)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/histograms
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    set new_num [format &#34;%.3d&#34; $num]
	    ssave h_mexican_tmp h_mexican$new_num -sw
	    ssave h_mexican_tmp h_max_mexican$new_num -sw 
	}
    }
    delete histo_tmp
    delete h_mexican_tmp

    cd ${<a name="dir(20)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}
    exec rm im.0 im.1
}

<strong><a name="compute_images_873">proc <a href="study.tcl-annot.html#compute_images">compute_images</a></a></strong><a name="compute_images"></a> {scale new_num} {
    <a name="conv_all(1)"><a href="./mmto.tcl.html#conv_all_20">conv_all</a></a> $scale
    gkapap kapap${new_num} dx dxx dy dyy dxy dxxx dxxy dxyy dyyy
    delete dxxx dxxy dxyy dyyy
    gkapa kapa${new_num} dx dxx dy dyy dxy
    delete dx dy dxx dxy dyy
}

<font color="#208020"># NEW !</font>
<strong><a name="compute_images_NEW_882">proc <a href="study.tcl-annot.html#compute_images_NEW">compute_images_NEW</a></a></strong><a name="compute_images_NEW"></a> {scale new_num} {
    <a name="__conv_all_derivatives(1)"><a href="./wt.tcl.html#__conv_all_derivatives_139">__conv_all_derivatives</a></a> $scale
    garg dx dy arg$new_num
    gmod dx dy mod$new_num
    gkapap kapap${new_num} dx dxx dy dyy dxy dxxx dxxy dxyy dyyy
    delete dxxx dxxy dxyy dyyy
    gkapa kapa${new_num} dx dxx dy dyy dxy
    delete dx dy dxx dxy dyy
}
<font color="#208020"># NEW !</font>

<strong><a name="images_histo_893">proc <a href="study.tcl-annot.html#images_histo">images_histo</a></a></strong><a name="images_histo"></a> {<a name="dir(21)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a> new_num} {
    source ${<a name="dir(22)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name ${<a name="dir(23)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../min_max_hist

    <font color="#208020"># Get histograms parameters</font>
    set hist_file_id [open $hist_file_name r]
    gets $hist_file_id hist_min
    gets $hist_file_id hist_max
    close $hist_file_id

    set pi 3.1416
    set m_pi -3.1416

    <font color="#208020"># Loading</font>
    sload h_mod$new_num h_mod$new_num -sw
    sload h_arg$new_num h_arg$new_num -sw
    iload calendos_image$new_num

    <font color="#208020"># Computing</font>
    ihisto mod$new_num h_mod_current_$new_num $nbox_mod \
	    -x $hist_min $hist_max 
    ihisto arg$new_num h_arg_current_$new_num $nbox_arg \
	    -x $m_pi $pi
    ihisto mod$new_num calendos_current_$new_num $calendos_size \
	    -x -$hist_max $hist_max -grad arg$new_num

    <font color="#208020"># Adding</font>
    sadd h_mod$new_num h_mod_current_$new_num h_mod$new_num
    sadd h_arg$new_num h_arg_current_$new_num h_arg$new_num
    iadd calendos_image$new_num calendos_current_$new_num 

    <font color="#208020"># Saving</font>
    ssave h_mod$new_num -sw
    ssave h_arg$new_num -sw
    isave calendos_image$new_num

    <font color="#208020"># Deleting</font>
    delete h_mod_current_$new_num \
	    h_arg_current_$new_num \
	    calendos_current_$new_num

    delete h_mod$new_num \
	    h_arg$new_num \
	    calendos_image$new_num
}

<strong><a name="mex_images_histo_940">proc <a href="study.tcl-annot.html#mex_images_histo">mex_images_histo</a></a></strong><a name="mex_images_histo"></a> {<a name="dir(24)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a> new_num} {
    source ${<a name="dir(25)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name ${<a name="dir(26)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../min_max_hist_mexican

    <font color="#208020"># Get histograms parameters</font>
    set hist_file_id [open $hist_file_name r]
    gets $hist_file_id hist_min
    gets $hist_file_id hist_max
    close $hist_file_id

    <font color="#208020"># Loading</font>
    sload h_mexican$new_num h_mexican$new_num -sw

    <font color="#208020"># Computing</font>
    ihisto mexican h_mexican_current_$new_num $nbox_mod \
	    -x $hist_min $hist_max 

    <font color="#208020"># Adding</font>
    sadd h_mexican$new_num h_mexican_current_$new_num h_mexican$new_num

    <font color="#208020"># Saving</font>
    ssave h_mexican$new_num -sw

    <font color="#208020"># Deleting</font>
    delete h_mexican_current_$new_num
    delete h_mexican$new_num
}

<strong><a name="compute_wtmm_969">proc <a href="study.tcl-annot.html#compute_wtmm">compute_wtmm</a></a></strong><a name="compute_wtmm"></a> {<a name="dir(27)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    source ${<a name="dir(28)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>

    <font color="#208020"># Get the size of the border </font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int($scale_max*$border_percent)]

    cd $dir

    <font color="#208020"># Computing the principal images</font>
    iload   image
    igfft   image __ft
    isave   image __image
    delete  image
    isave   __ft
    delete  __ft

    <font color="#208020"># Compute the wtmm and the images histograms for each scale.</font>
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {

	    <font color="#208020"># Setting of local parameters</font>
	    set scale [expr $amin*pow(2,$oct+($vox/double($nvox)))]
	    set scale [expr $scale*(6/0.86)]
	    <a name="nputs(9)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  Octave $oct - vox $vox - scale $scale ( $num )&#34;
	    set new_num [format &#34;%.3d&#34; $num]
	    
	    <a name="dputs(12)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    compute mod arg kapa and kapap...&#34;
	    <a name="compute_images_NEW(1)"><a href="./study.tcl.html#compute_images_NEW_882">compute_images_NEW</a></a> $scale $new_num

	    <a name="dputs(13)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    research of maxima...&#34;
	    follow kapa${new_num} kapap${new_num} \
                    mod${new_num} arg${new_num} max$new_num $scale

	    <font color="#208020"># We remove the border of the ext_image</font>
	    set border [expr $size-$border_size]
	    rm_ext max$new_num max$new_num $border_size $border $border_size $border

	    esave max$new_num
	    delete max$new_num

	    <font color="#208020"># We remove the border of the image</font>
	    cutedge mod$new_num mod$new_num $border_size
	    cutedge arg$new_num arg$new_num $border_size

	    if {$iscontpart == 1} {
		<a name="dputs(14)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    continuous partition functions...&#34; 
		cd ${<a name="dir(29)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../partition
		<font color="#208020">#ipart $amin $noct $nvox $num partcont mod \</font>
			<font color="#208020">#-qfile ${dir}/../pos_q_values</font>

		<a name="isw_add_fqaqtq_one(1)"><a href="./part_fcts.tcl.html#isw_add_fqaqtq_one_499">isw_add_fqaqtq_one</a></a> mod $amin $noct $nvox $num $pos_q_lst new_partcont
	    }

	    if {$ishisto == 1} {
		<a name="dputs(15)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    computation of complete histograms.&#34;
		cd ${<a name="dir(30)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../histograms
		<a name="images_histo(1)"><a href="./study.tcl.html#images_histo_893">images_histo</a></a> $dir $new_num
	    }

	    cd $dir

	    <font color="#208020"># Deleting intermediate images</font>
	    delete arg$new_num
	    delete mod$new_num
	    delete kapa${new_num}
	    delete kapap${new_num}
	}
    }
    
    <font color="#208020"># Deleting the principal images</font>
    exec rm __image
    exec rm __ft

    cd ${<a name="dir(31)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/..
}

<strong><a name="compute_mexican_1054">proc <a href="study.tcl-annot.html#compute_mexican">compute_mexican</a></a></strong><a name="compute_mexican"></a> {<a name="dir(32)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    source ${<a name="dir(33)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>

    <font color="#208020"># Get the size of the border </font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int($scale_max*$border_percent)]

    cd $dir

    <font color="#208020"># Computing the principal images</font>
    iload   image im
    itofft  im 	IMAGE
    isave   im im.0
    delete im
    fft     IMAGE
    isave   IMAGE       im.1

    <font color="#208020"># Compute the wtmm and the images histograms for each scale.</font>
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {

	    <font color="#208020"># Setting of local parameters</font>
	    set scale [expr $amin*pow(2,$oct+($vox/double($nvox)))]
	    set scale [expr $scale*(6/0.86)]
	    <a name="nputs(10)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;  Octave $oct - vox $vox - scale $scale ( $num )&#34;
	    set new_num [format &#34;%.3d&#34; $num]
	    
	    <a name="dputs(16)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    compute mexican...&#34;
	    <a name="conv_w(3)"><a href="./mmto.tcl.html#conv_w_11">conv_w</a></a> mexican $scale

	    <a name="dputs(17)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    research of maxima...&#34;
	    locmax mexican mex$new_num $scale -ext

	    <font color="#208020"># We remove the border of the ext_image</font>
	    set border [expr $size-$border_size]
	    rm_ext mex$new_num mex$new_num $border_size $border $border_size $border

	    esave mex$new_num
	    delete mex$new_num

	    <font color="#208020"># We remove the border of the image</font>
	    cutedge mexican mexican $border_size

	    if {$iscontpart == 1} {
		<a name="dputs(18)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    continuous partition functions...&#34; 
		cd ${<a name="dir(34)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../partition
		<font color="#208020">#ipart $amin $noct $nvox $num partcont mod \</font>
			<font color="#208020">#-qfile ${dir}/../pos_q_values</font>

		icopy mexican mexican$new_num
		<a name="isw_add_fqaqtq_one(2)"><a href="./part_fcts.tcl.html#isw_add_fqaqtq_one_499">isw_add_fqaqtq_one</a></a> mexican $amin $noct $nvox $num $pos_q_lst mex_partcont
		delete mexican$new_num
	    }

	    if {$ishisto == 1} {
		<a name="dputs(19)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;    computation of complete histograms.&#34;
		cd ${<a name="dir(35)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../histograms
		<a name="mex_images_histo(1)"><a href="./study.tcl.html#mex_images_histo_940">mex_images_histo</a></a> $dir $new_num
	    }

	    cd $dir

	    <font color="#208020"># Deleting intermediate images</font>
	    delete mexican
	}
    }
    
    <font color="#208020"># Deleting the principal images</font>
    delete IMAGE
    exec rm im.0
    exec rm im.1

    cd ${<a name="dir(36)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/..
}

<strong><a name="max_histos_1137">proc <a href="study.tcl-annot.html#max_histos">max_histos</a></a></strong><a name="max_histos"></a> {<a name="dir(37)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a> new_num} {
    source ${<a name="dir(38)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name ${<a name="dir(39)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../min_max_hist

    <font color="#208020"># Get histograms parameters</font>
    set hist_file_id [open $hist_file_name r]
    gets $hist_file_id hist_min
    gets $hist_file_id hist_max
    close $hist_file_id

    set pi 3.1416
    set m_pi -3.1416
    
    <font color="#208020"># For all the maxima</font>

    <font color="#208020"># Loading</font>
    sload h_max_mod$new_num h_max_mod$new_num -sw
    sload h_max_arg$new_num h_max_arg$new_num -sw
    iload calendos_max$new_num

    <font color="#208020"># Computing	</font>
    ehisto max$new_num h_max_mod_current_$new_num \
	    $nbox_mod -x $hist_min $hist_max 
    ehisto max$new_num h_max_arg_current_$new_num \
	    $nbox_arg -x $m_pi $pi -arg
    ehisto max$new_num calendos_max_current_$new_num \
	    $calendos_size -x -$hist_max $hist_max -grad

    <font color="#208020"># Adding</font>
    sadd h_max_mod$new_num h_max_mod_current_$new_num \
	    h_max_mod$new_num
    sadd h_max_arg$new_num h_max_arg_current_$new_num \
	    h_max_arg$new_num
    iadd calendos_max$new_num calendos_max_current_$new_num

    <font color="#208020"># Saving</font>
    ssave h_max_mod$new_num -sw		
    ssave h_max_arg$new_num -sw
    isave calendos_max$new_num

    <font color="#208020"># Deleting</font>
    delete h_max_mod_current_$new_num \
	    h_max_arg_current_$new_num \
	    calendos_max_current_$new_num

    delete h_max_mod$new_num \
	    h_max_arg$new_num \
	    calendos_max$new_num

    <font color="#208020"># Only for the max _potential_</font>
    
    <font color="#208020"># Loading</font>
    sload h_max_line_mod$new_num h_max_line_mod$new_num -sw
    sload h_max_line_arg$new_num h_max_line_arg$new_num -sw
    iload calendos_max_line$new_num

    <font color="#208020"># Computing</font>
    ehisto max$new_num h_max_mod_current_$new_num \
	    $nbox_mod -x $hist_min $hist_max -vc
    ehisto max$new_num h_max_arg_current_$new_num \
	    $nbox_arg -x $m_pi $pi -arg -vc
    ehisto max$new_num calendos_max_current_$new_num \
	    $calendos_size -x -$hist_max $hist_max -grad -vc
    
    <font color="#208020"># Adding</font>
    sadd h_max_line_mod$new_num h_max_mod_current_$new_num \
	    h_max_line_mod$new_num
    sadd h_max_line_arg$new_num h_max_arg_current_$new_num \
	    h_max_line_arg$new_num
    iadd calendos_max_line$new_num calendos_max_current_$new_num

    <font color="#208020"># Saving</font>
    ssave h_max_line_mod$new_num -sw
    ssave h_max_line_arg$new_num -sw
    isave calendos_max_line$new_num
    
    <font color="#208020"># Deleting</font>
    delete h_max_mod_current_$new_num \
	    h_max_arg_current_$new_num \
	    calendos_max_current_$new_num

    delete h_max_line_mod$new_num \
	    h_max_line_arg$new_num \
	    calendos_max_line$new_num
}

<strong><a name="max_mexican_histos_1224">proc <a href="study.tcl-annot.html#max_mexican_histos">max_mexican_histos</a></a></strong><a name="max_mexican_histos"></a> {<a name="dir(40)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a> new_num} {
    source ${<a name="dir(41)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name ${<a name="dir(42)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../min_max_hist_mexican

    <font color="#208020"># Get histograms parameters</font>
    set hist_file_id [open $hist_file_name r]
    gets $hist_file_id hist_min
    gets $hist_file_id hist_max
    close $hist_file_id

    <font color="#208020"># For all the maxima</font>

    sload h_max_mexican$new_num h_max_mexican$new_num -sw

    ehisto mex$new_num h_max_mexican_current_$new_num \
	    $nbox_mod -x $hist_min $hist_max 

    sadd h_max_mexican$new_num h_max_mexican_current_$new_num \
	    h_max_mexican$new_num

    ssave h_max_mexican$new_num -sw		

    delete h_max_mexican_current_$new_num
    delete h_max_mexican$new_num
}

<strong><a name="compute_wtmm_max_stat_1251">proc <a href="study.tcl-annot.html#compute_wtmm_max_stat">compute_wtmm_max_stat</a></a></strong><a name="compute_wtmm_max_stat"></a> {<a name="dir(43)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    source ${<a name="dir(44)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>

    <font color="#208020"># Get the size of the border </font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int($scale_max*$border_percent)]

    cd $dir

    puts &#34;&#34;
    <a name="nputs(11)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;Horizontal and vertical chain of the maxima.&#34;
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    <font color="#208020"># Setting of local parameters</font>
	    set scale [expr $amin*pow(2,$oct+($vox/double($nvox)))]
	    set scale [expr $scale*(6/0.86)]
	    <a name="dputs(20)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  Octave $oct - vox $vox - scale $scale ( $num )&#34;
	    set new_num [format &#34;%.3d&#34; $num]
	    set prev_num [expr $num-1]
	    set prev_new_num [format &#34;%.3d&#34; $prev_num]

	    eload max$new_num

	    <font color="#208020"># We remove the border of the ext_image</font>
	    <font color="#208020">#set border [expr $size-$border_size]</font>
	    <font color="#208020">#rm_ext max$new_num max$new_num $border_size $border $border_size $border</font>

	    <font color="#208020"># Research of maxima lines and maxima line maxima (yes, don't laugh).</font>
	    hsearch max$new_num
	    ssm max$new_num

	    set box_size [expr int(log($scale)*2/log(2))]
	    if { $prev_num == 0} {
		vchain max$prev_new_num max$new_num $box_size $similitude -first
	    } else {
		if {$prev_num &gt; 0} {
		    vchain max$prev_new_num max$new_num $box_size $similitude
		}
	    }
	}   
    }

    puts &#34;&#34;
    <a name="nputs(12)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;Maxima partition functions and histogramms.&#34;
    cd ${<a name="dir(45)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../partition
    
    <font color="#208020">#partition $amin $noct $nvox l_part max* \</font>
	    <font color="#208020">#-qfile ${dir}/../q_values</font>

    <a name="dputs(21)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  On contour lines.&#34;
    <a name="sw_add_fqaqtq(1)"><a href="./part_fcts.tcl.html#sw_add_fqaqtq_119">sw_add_fqaqtq</a></a> max $amin $noct $nvox $q_lst l_part

    <a name="dputs(22)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  On maxima.&#34;
    <a name="sw_add_fqaqtq(2)"><a href="./part_fcts.tcl.html#sw_add_fqaqtq_119">sw_add_fqaqtq</a></a> max $amin $noct $nvox $q_lst m_part -vc

    if {[info exists theta_lst] == 1} {
	<a name="dputs(23)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  On maxima conditionned by gradient direction :&#34;
	puts -nonewline &#34;              &#34;
	set num 0
	set pi 3.1416
	set m_pi -3.1416
	foreach {theta d_theta name} $theta_lst {
	    puts -nonewline &#34;$theta &#34;
	    set simil [expr 1-$d_theta/(2*$pi)]
	    <a name="sw_add_fqaqtq(3)"><a href="./part_fcts.tcl.html#sw_add_fqaqtq_119">sw_add_fqaqtq</a></a> max $amin $noct $nvox $q_lst $name -vc -arg $theta $simil
	    incr num
	}
    }

    puts &#34;&#34;

    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    set new_num [format &#34;%.3d&#34; $num]
	    <font color="#208020"># We compute the differents maxima's histograms </font>
	    if {$ismaxhisto == 1} {
		<a name="dputs(24)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  Computation of maxima's histograms ($new_num).&#34;

		cd ${<a name="dir(46)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../histograms
		<a name="max_histos(1)"><a href="./study.tcl.html#max_histos_1137">max_histos</a></a> $dir $new_num
	    }
	}
    }
    
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    set new_num [format &#34;%.3d&#34; $num]
	    delete max$new_num
	}
    }
    
}

<strong><a name="compute_mexican_max_stat_1360">proc <a href="study.tcl-annot.html#compute_mexican_max_stat">compute_mexican_max_stat</a></a></strong><a name="compute_mexican_max_stat"></a> {<a name="dir(47)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    source ${<a name="dir(48)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>

    <font color="#208020"># Get the size of the border </font>
    set no [expr $noct-1]
    set nv [expr $nvox-1]
    set scale_max [expr $amin*pow(2,$no+($nv/double($nvox)))]
    set scale_max [expr $scale_max*(6/0.86)]
    set border_size [expr int($scale_max*$border_percent)]

    cd $dir

    puts &#34;&#34;
    <a name="nputs(13)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;Vertical chain of the mexican maxima.&#34;
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    <font color="#208020"># Setting of local parameters</font>
	    set scale [expr $amin*pow(2,$oct+($vox/double($nvox)))]
	    set scale [expr $scale*(6/0.86)]
	    <a name="dputs(25)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  Octave $oct - vox $vox - scale $scale ( $num )&#34;
	    set new_num [format &#34;%.3d&#34; $num]
	    set prev_num [expr $num-1]
	    set prev_new_num [format &#34;%.3d&#34; $prev_num]

	    eload mex$new_num

	    <font color="#208020"># We remove the border of the ext_image</font>
	    set border [expr $size-$border_size]
	    rm_ext mex$new_num mex$new_num $border_size $border $border_size $border

	    <font color="#208020"># Research of maxima lines and maxima line maxima (yes, don't laugh).</font>
	    set box_size [expr int(log($scale)*2/log(2))]
	    if { $prev_num == 0} {
		vchain2 mex$prev_new_num mex$new_num $box_size $similitude -first
	    } else {
		if {$prev_num &gt; 0} {
		    vchain2 mex$prev_new_num mex$new_num $box_size $similitude
		}
	    }
	}   
    }

    puts &#34;&#34;
    <a name="nputs(14)"><a href="./new_puts.tcl.html#nputs_21">nputs</a></a> &#34;Mexican maxima partition functions and histogramms.&#34;
    cd ${<a name="dir(49)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../partition
    
    <a name="sw_add_fqaqtq(4)"><a href="./part_fcts.tcl.html#sw_add_fqaqtq_119">sw_add_fqaqtq</a></a> mex $amin $noct $nvox $q_lst mex_part

    puts &#34;&#34;

    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    set new_num [format &#34;%.3d&#34; $num]
	    <font color="#208020"># We compute the differents maxima's histograms </font>
	    if {$ismaxhisto == 1} {
		<a name="dputs(26)"><a href="./new_puts.tcl.html#dputs_12">dputs</a></a> &#34;  Computation of maxima's histograms ($new_num).&#34;

		cd ${<a name="dir(50)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../histograms
		pwd
		<a name="max_mexican_histos(1)"><a href="./study.tcl.html#max_mexican_histos_1224">max_mexican_histos</a></a> $dir $new_num
	    }
	}
    }
    
    for { set oct 0;set num 0}\
	    { $oct &lt; $noct} \
	    { incr oct } {
	for {set vox 0} \
		{ $vox &lt; $nvox } \
		{ incr vox ; incr num} {
	    set new_num [format &#34;%.3d&#34; $num]
	    delete mex$new_num
	}
    }
    
}

<strong><a name="set_hist_to_null_1446">proc <a href="study.tcl-annot.html#set_hist_to_null">set_hist_to_null</a></a></strong><a name="set_hist_to_null"></a> {<a name="dir(51)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>} {
    source ${<a name="dir(52)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/parameters.tcl
    <font color="#208020"># !!!!!! Rajouter tests existence/validite des parametres !!!!!!!!</font>
    set hist_file_name ${<a name="dir(53)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/../min_max_hist

    <font color="#208020"># Get histograms parameters</font>
    set hist_file_name min_max_hist
    set hist_file_id [open $hist_file_name r]
    gets $hist_file_id hist_min
    gets $hist_file_id hist_max
    close $hist_file_id

    set pi 3.1416
    set m_pi -3.1416

    cd ${<a name="dir(54)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}
    <font color="#208020"># Initialisation of the global histograms at each scale (with gaussian).</font>
    sinus histo_tmp 100
    shisto histo_tmp h_mod_tmp $nbox_mod -x $hist_min $hist_max
    shisto histo_tmp h_arg_tmp $nbox_arg -x $m_pi $pi
    sscamult h_mod_tmp 0.0 h_mod_tmp
    sscamult h_arg_tmp 0.0 h_arg_tmp

    inull calendos_temp $calendos_size
    cd ${<a name="dir(55)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/histograms
    for { set oct 0;set num 0}\
            { $oct &lt; $noct} \
            { incr oct } {
        for {set vox 0} \
                { $vox &lt; $nvox } \
                { incr vox ; incr num} {
            set new_num [format &#34;%.3d&#34; $num]

            <font color="#208020">#  Gradient histograms from all points (mod, arg, gradient vector)</font>
            ssave h_mod_tmp h_mod$new_num -sw
            ssave h_arg_tmp h_arg$new_num -sw
            isave calendos_temp calendos_image$new_num

            <font color="#208020">#  Gradient histograms from all points on lines (mod, arg,</font>
            <font color="#208020"># gradient vector)</font>
            ssave h_mod_tmp h_max_mod$new_num -sw
            ssave h_arg_tmp h_max_arg$new_num -sw

            isave calendos_temp calendos_max$new_num

            <font color="#208020">#  Gradient histograms from all max on lines (mod, arg, gradient</font>
            <font color="#208020"># vector)</font>
            ssave h_mod_tmp h_max_line_mod$new_num -sw
            ssave h_arg_tmp h_max_line_arg$new_num -sw
            isave calendos_temp calendos_max_line$new_num

        }
    }
    delete histo_tmp
    delete h_mod_tmp
    delete h_arg_tmp
    delete calendos_temp

    cd ${<a name="dir(56)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}
    <font color="#208020"># Initialisation of the global histograms at each scale (mexican).</font>
    set hist_file_name min_max_hist_mexican
    set hist_file_id [open $hist_file_name r]
    gets $hist_file_id hist_min
    gets $hist_file_id hist_max
    close $hist_file_id

    sinus histo_tmp 100
    shisto histo_tmp h_mexican_tmp $nbox_mod -x $hist_min $hist_max

    sscamult h_mexican_tmp 0.0 h_mexican_tmp

    cd ${<a name="dir(57)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}/histograms
    for { set oct 0;set num 0}\
            { $oct &lt; $noct} \
            { incr oct } {
        for {set vox 0} \
                { $vox &lt; $nvox } \
                { incr vox ; incr num} {
            set new_num [format &#34;%.3d&#34; $num]
            ssave h_mexican_tmp h_mexican$new_num -sw
            ssave h_mexican_tmp h_max_mexican$new_num -sw 
        }
    }
    delete histo_tmp
    delete h_mexican_tmp

    cd ${<a name="dir(58)"><a href="./tkcon.tcl.html#dir_4606">dir</a></a>}
}
</pre>
<hr>
<font size="-2">
<a href="xsmurf_tcl_lib_intro.html">Overview</a> | Index by:  <a href="index_main.html#byfilename">file name</a> |
<a href="index_main.html#byprocname">procedure name</a> |
<a href="index_main.html#bycall">procedure call</a> |
<a href="index_annot_full.html">annotation</a><br>
<cite>File generated 2008-04-03 at 09:49.</cite>
</font>
</body>
</html>
