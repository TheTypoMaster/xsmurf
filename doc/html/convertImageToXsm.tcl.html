<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- Generated by TclDoc 0.3 -->
<html>
<head><title>convertImageToXsm.tcl</title></head>
<body bgcolor="#ffffff">
<font size="-2">
<a href="xsmurf_tcl_lib_intro.html">Overview</a> | Index by:  <a href="index_main.html#convertImageToXsm.tcl">file name</a> |
<a href="index_main.html#byprocname">procedure name</a> |
<a href="index_main.html#bycall">procedure call</a> |
<a href="index_annot_full.html">annotation</a>
</font>
<hr>
<strong>convertImageToXsm.tcl</strong>
(<a href="convertImageToXsm.tcl-annot.html">annotations</a> | <a href="convertImageToXsm.tcl.txt">original source</a>)
<p>
<pre>
<font color="#208020"># convertImageToXsm.tcl --</font>
<font color="#208020">#</font>
<font color="#208020">#       This file implements the Tcl code for converting an image (TIFF, JPEG, BMP, PNG)</font>
<font color="#208020">#      into the native xsmurf file format.</font>
<font color="#208020">#</font>
<font color="#208020">#   Copyright 2008 CEA, IRFU, Saclay, France</font>
<font color="#208020">#   Written by Pierre Kestener (pierre.kestener@cea.fr).</font>
<font color="#208020">#</font>
package require vtk
package require fileutil

<font color="#208020"># conv2xsm --</font>
<font color="#208020"># usage: conv2xsm str str</font>
<font color="#208020">#</font>
<font color="#208020"># Convert an image file (TIFF, JPEG, BMP or PNG file format) into the native xsmurf file format</font>
<font color="#208020"># using the tcl bindings of the VTK library (http://www.vtk.org)</font>
<font color="#208020">#</font>
<font color="#208020"># Parameters:</font>
<font color="#208020">#   string - input file name</font>
<font color="#208020">#   string - output file name (without extension)</font>
<font color="#208020">#</font>
<font color="#208020"># Options:</font>
<font color="#208020">#</font>
<font color="#208020"># Return value:</font>
<font color="#208020">#   None.</font>

<strong><a name="conv2xsm_27">proc <a href="convertImageToXsm.tcl-annot.html#conv2xsm">conv2xsm</a></a></strong><a name="conv2xsm"></a> {iname oname} {

    if {[file exists $iname] != 1} {
	return -code error &#34;Input file does not exists !&#34;
    }
    set iExtension [file extension $iname]
    
    <font color="#208020"># create reader object</font>
    switch -exact -- $iExtension {
	.tif {
	    vtkTIFFReader iReader
	}
	.jpg {
	    vtkJPEGReader iReader
	}
	.png {
	    vtkPNGReader iReader
	}
	.pnm {
	    vtkPNMReader iReader
	}
	.bmp {
	    vtkBMPReader iReader
	}
    }
    
    <font color="#208020"># read input</font>
    iReader SetFileName $iname
    iReader Update
    
    <font color="#208020"># get dimensions</font>
    set dimX [lindex [[iReader GetOutput] GetDimensions] 0]
    set dimY [lindex [[iReader GetOutput] GetDimensions] 1]
    <font color="#208020">#puts &#34;$dimX $dimY&#34;</font>

    <font color="#208020"># convert image to a gray scale valued image</font>
    vtkImageLuminance il
    il SetInputConnection [iReader GetOutputPort]

   <font color="#208020"># cast luminance image to float data type</font>
    vtkImageCast ic
    ic SetOutputScalarTypeToFloat
    ic SetInputConnection [il GetOutputPort]

    <font color="#208020">#</font>
    <font color="#208020"># write to a temp directory; use .</font>
    <font color="#208020">#</font>
   set dir &#34;.&#34;
    
    <font color="#208020"># make sure it is writeable first</font>
    if {[catch {set channel [open &#34;$dir/test.tmp&#34; &#34;w&#34;]}] == 0 } {
	close $channel
	file delete -force &#34;$dir/test.tmp&#34;
	
	<font color="#208020"># create writer object</font>
	vtkMetaImageWriter iWriter
	
	<font color="#208020"># write data to file</font>
	iWriter SetInputConnection [ic GetOutputPort]
	iWriter SetFileName &#34;${oname}&#34;
	iWriter SetRAWFileName &#34;${oname}.xsm&#34;
	iWriter Write

	<font color="#208020"># delete Meta Image header file</font>
	file delete-force $oname

	<font color="#208020"># insert xsmurf-specific header</font>
	set size [expr $dimX * $dimY]
	::fileutil::insertIntoFile ${oname}.xsm 0 &#34;Binary 1 ${dimX}x${dimY} ${size}(4 byte reals)\n&#34;
	
	<font color="#208020"># load image</font>
	iload ${oname}.xsm ${oname}.tmp
	iswapraw ${oname}.tmp ${oname}
	delete ${oname}.tmp

	<font color="#208020"># delete writer</font>
	iWriter Delete

    }

    <font color="#208020"># delete other vtk-specific structures</font>
    iReader Delete
    ic Delete
    il Delete

    puts &#34;${oname} loaded.&#34;

}
</pre>
<hr>
<font size="-2">
<a href="xsmurf_tcl_lib_intro.html">Overview</a> | Index by:  <a href="index_main.html#byfilename">file name</a> |
<a href="index_main.html#byprocname">procedure name</a> |
<a href="index_main.html#bycall">procedure call</a> |
<a href="index_annot_full.html">annotation</a><br>
<cite>File generated 2008-04-03 at 09:49.</cite>
</font>
</body>
</html>
